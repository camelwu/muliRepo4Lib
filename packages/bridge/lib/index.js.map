{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["interface Bridge {}\n\ntype GlobalBridge = Bridge | null;\ndeclare global {\ninterface Window {\n    WebViewJavascriptBridge: object;\n    WVJBCallbacks: (Function)[];\n    ampTpl: string;\n    linkedFn: Function | undefined;\n    jsInterface: {\n        invokeMethod: Function;\n    };\n    // WVJBCallbacks: any[];\n    RongIMLib: any;\n    RongIMClient: any;\n    _czc: any;\n    _hmt: any;\n    meteor: any;\n    dataLayer: any;\n    gdt: any;\n    MtaH5: any;\n    zc: (action: string, options: { [key: string]: any }) => void;\n    cbk: any[];\n}\n}\nlet globalBridge: GlobalBridge = null;\n\nconst init = () => {};\n\nconst getBridge = () => globalBridge;\n\n/**\n * 拦截 bridge 对象\n *\n * @param {*} callback\n * @returns\n */\nconst setupHooks = (callback: (bridge: GlobalBridge) => void) => {\n    return (jsBridge: any) => {\n        globalBridge = jsBridge;\n        if (callback) {\n            return callback(globalBridge);\n        }\n        return null;\n    };\n};\n\n/**\n * 开始启动bridge\n *\n * @param {*} setupFn\n * @returns\n */\nconst setupWebViewJavascriptBridge = (setupFn: () => {}) => {\n    const callback = setupHooks(setupFn);\n    // electron 是preload也就是加载前注入，这里应该始终存在，为了防止以为 electron 需要响应备选请求\n    if (window.WebViewJavascriptBridge) {\n        return callback(window.WebViewJavascriptBridge);\n    }\n    if (window.WVJBCallbacks) {\n        return window.WVJBCallbacks.push(callback);\n    }\n    window.WVJBCallbacks = [callback];\n    // 兼容IOS，注入时间后延，防止出现不执行的情况\n    const WVJBIframe = document.createElement('iframe');\n    WVJBIframe.style.display = 'none';\n    WVJBIframe.src = 'https://__bridge_loaded__';\n    document.documentElement.appendChild(WVJBIframe);\n    setTimeout(() => {\n        document.documentElement.removeChild(WVJBIframe);\n    }, 0);\n    return null;\n};\n\nconst getPlatform = () => {\n    const u = navigator.userAgent;\n    return {\n        trident: u.indexOf('Trident') > -1,\n        presto: u.indexOf('Presto') > -1,\n        webKit: u.indexOf('AppleWebKit') > -1,\n        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') === -1,\n        mobile: !!u.match(/AppleWebKit.*Mobile.*/) || !!u.match(/AppleWebKit/),\n        ios: !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),\n        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1,\n        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1,\n        iPad: u.indexOf('iPad') > -1,\n        webApp: u.indexOf('Safari') === -1, // 是否web应该程序，没有头部与底部\n    };\n};\n\nexport default {\n    bridge: {\n        init,\n        setupWebViewJavascriptBridge,\n        getPlatform,\n        getBridge,\n    },\n};\n"],"names":[],"mappings":";;;;AAyBA,IAAI,YAAY,GAAiB,IAAI,CAAC;AAEtC,MAAM,IAAI,GAAG,SAAQ,CAAC;AAEtB,MAAM,SAAS,GAAG,MAAM,YAAY,CAAC;AAErC;;;;;;AAMA,MAAM,UAAU,GAAG,CAAC,QAAwC;IACxD,OAAO,CAAC,QAAa;QACjB,YAAY,GAAG,QAAQ,CAAC;QACxB,IAAI,QAAQ,EAAE;YACV,OAAO,QAAQ,CAAC,YAAY,CAAC,CAAC;SACjC;QACD,OAAO,IAAI,CAAC;KACf,CAAC;AACN,CAAC,CAAC;AAEF;;;;;;AAMA,MAAM,4BAA4B,GAAG,CAAC,OAAiB;IACnD,MAAM,QAAQ,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;;IAErC,IAAI,MAAM,CAAC,uBAAuB,EAAE;QAChC,OAAO,QAAQ,CAAC,MAAM,CAAC,uBAAuB,CAAC,CAAC;KACnD;IACD,IAAI,MAAM,CAAC,aAAa,EAAE;QACtB,OAAO,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KAC9C;IACD,MAAM,CAAC,aAAa,GAAG,CAAC,QAAQ,CAAC,CAAC;;IAElC,MAAM,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IACpD,UAAU,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;IAClC,UAAU,CAAC,GAAG,GAAG,2BAA2B,CAAC;IAC7C,QAAQ,CAAC,eAAe,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;IACjD,UAAU,CAAC;QACP,QAAQ,CAAC,eAAe,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;KACpD,EAAE,CAAC,CAAC,CAAC;IACN,OAAO,IAAI,CAAC;AAChB,CAAC,CAAC;AAEF,MAAM,WAAW,GAAG;IAChB,MAAM,CAAC,GAAG,SAAS,CAAC,SAAS,CAAC;IAC9B,OAAO;QACH,OAAO,EAAE,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QAClC,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAChC,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QACrC,KAAK,EAAE,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAC3D,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,aAAa,CAAC;QACtE,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,+BAA+B,CAAC;QAC/C,OAAO,EAAE,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAC7D,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACzD,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAC5B,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;KACrC,CAAC;AACN,CAAC,CAAC;AAEF,YAAe;IACX,MAAM,EAAE;QACJ,IAAI;QACJ,4BAA4B;QAC5B,WAAW;QACX,SAAS;KACZ;CACJ;;;;"}